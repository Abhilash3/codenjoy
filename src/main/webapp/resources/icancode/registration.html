<!DOCTYPE html>
<!--
  #%L
  iCanCode - it's a dojo-like platform from developers to developers.
  %%
  Copyright (C) 2016 EPAM
  %%
  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as
  published by the Free Software Foundation, either version 3 of the
  License, or (at your option) any later version.
  
  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.
  
  You should have received a copy of the GNU General Public
  License along with this program.  If not, see
  <http://www.gnu.org/licenses/gpl-3.0.html>.
  #L%
  -->

<html lang="en">
  <head>
    <link href="css/reset.css" rel="stylesheet"/>
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="bootstrap/css/bootstrap-theme.min.css" rel="stylesheet"/>
    <link href="fonts/font-awesome-4.6.3/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="css/registration-style.css" rel="stylesheet"/>
    <script src="js/jquery/jquery-3.1.0.js"></script>
    <script src="js/autofill-event.js"></script>
    <script src="js/jquery/jquery.md5.js"></script>
    <script>
        $(document).ready(function () {
            var gameName = localStorage.getItem('gameName');
            if (!!gameName) {
                $("#game select").val(gameName);
            }
            var email = localStorage.getItem('registration-email');
            if (!!email) {
              $('#email input').val(email);
            }
            var data = localStorage.getItem('registration-data');
            if (!!data) {
                $('#data input').val(data);
            }
            var data1 = localStorage.getItem('registration-data1');
            if (!!data1) {
                $('#data1 input').val(data1);
            }
            var data2 = localStorage.getItem('registration-data2');
            if (!!data2) {
                $('#data2 input').val(data2);
            }
            var data3 = localStorage.getItem('registration-data3');
            if (!!data3) {
                $('#data3 input').val(data3);
            }

            var checkEls = {};

            var validateEmail = function(email) {
                var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
                return emailReg.test(email);
            }

            checkEls['email'] = function(value) {
                return value == '' || !validateEmail(value);
            };

            var notEmpty = function(value) {
                return value == '' || value.length == 0;
            };

            checkEls['password'] = notEmpty;

            var configurable = function(name) {
                checkEls[name] = function(value) {
                    if ($('#' + name)[0].hasAttribute('hidden')) {
                        return false;
                    }
                    if ($('#' + name)[0].hasAttribute('not-empty')) {
                        return notEmpty(value);
                    }
                    return false;
                };
            }

            configurable('data1');
            configurable('data2');
            configurable('data3');

            var validateElements = function() {
                for (var index in checkEls) {
                    if (!checkEls.hasOwnProperty(index)) {
                        continue;
                    }

                    var element = $('#' + index);
                    var value = element.find('input').val();
                    if (checkEls[index](value)) {
                        element.addClass('not-valid');
                        element.removeClass('valid');
                    } else {
                        element.addClass('valid');
                        element.removeClass('not-valid');
                    }
                }
            };

            var validation = function(id) {
                var element = $('#' + id);

                element.keyup(validateElements);
                element.focus(validateElements);
                element.blur(validateElements);
                element.mousedown(validateElements);
                element.change(validateElements);

                validateElements();
            };

            $('#email').checkAndTriggerAutoFillEvent();
            $('#password').checkAndTriggerAutoFillEvent();

            for (var index in checkEls) {
                if (!checkEls.hasOwnProperty(index)) {
                    continue;
                }

                validation(index);
            }

            var submitForm = function() {
                if ($('form .not-valid').length == 0) {
                    $('#data input').val(
                        $('#data1 input').val() + "|" +
                        $('#data2 input').val() + "|" +
                        $('#data3 input').val()
                    );

                    $("#password input").val($.md5($("#password input").val()));
                    localStorage.setItem('gameName', $("#game option:selected").text());
                    localStorage.setItem('registration-email', $('#email input').val());
                    localStorage.setItem('registration-skills', $('#skills input').val());
                    $("#form").submit();
                }
            }

            $('#submit-button').click(submitForm);
            $('#email, #password, #skills').keypress(function(e) {
                var code = (e.keyCode ? e.keyCode : e.which);
                if (code == 13) {
                    submitForm();
                    e.preventDefault();
                }
            });
        });
    </script>
  </head>
  <body>
    <div class="header-container">
      <div class="container-fluid">
        <header class="header row">
          <div class="col-xs-6">
            <a class="logo inline" href="#" title="Home"><img src="img/logo.png"></a>
            <span class="title engx-title">EPAM EngX&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <a class="logo inline" href="#" title="Home"><img src="img/i_can_code_Logo.png"></a>
            <span class="title icancode-title">ICanCode</span>
          </div>
          <nav class="nav col-xs-6 pull-right text-right">
            <ul class="nav-list">
              <li class="title icancode-title inline"><a id="additional-link" target="_blank" href="#"></a></li>
              <li class="title icancode-title inline"><a id="help-link" target="_blank" href="#"></a></li>
              <li class="logo title inline"><img src="img/profile.png"></li>
              <li class="title inline"><a href="/codenjoy-contest/resources/icancode/registration.html">Log out</a></li>
            </ul>
          </nav>
        </header>
    </div>
    </div>
    <div class="container-fluid">
      <form class="form-registr" id="form" action="/codenjoy-contest/register" method="POST">
        <h2 class="form-title">Sign up/Sign in</h2>
        <div class="inputs">
          <div id="email" class="field not-valid">
            <input type="email" placeholder="Email address (valid)" name="name"/>
            <span class="icon fa"></span>
          </div>	  			
          <div id="password" class="field not-valid">
            <input type="password" placeholder="Password" name="password"/>
            <span class="icon fa"></span>
          </div>
          <!-- add attribute 'hidden' to the div if you want to hide this select box -->
          <div id="game" class="field valid"> 
            <select placeholder="Select your game" name="game">
              <option value="iCanCode Training" default>iCanCode Training</option>
              <option value="iCanCode Contest">iCanCode Contest</option>
              <option value="eKids">eKids</option>
            </select>
          </div>
          <div id="data" hidden>
              <input type="text" name="data"/>
          </div>
          <div id="data1" class="field not-valid" not-empty>
              <input type="text" placeholder="First name, last name"/>
              <span class="icon fa"></span>
          </div>
          <!-- add attribute 'not-empty' to the div if you want to enable validation -->
          <!-- add attribute 'hidden' to the div if you want to hide this edit box -->
          <div id="data2" class="field not-valid" not-empty> 
               <!-- also you can change input placeholder="Tech skills" -->
              <input type="text" placeholder="Tech skills"/> 
              <span class="icon fa"></span>
          </div>
          <div id="data3" class="field not-valid" hidden>
            <input type="text" placeholder="University, specialty, course"/>
            <span class="icon fa"></span>
          </div>
		  <input type="hidden" name="gameName" value="icancode"/>
          <button class="btn-submit" id="submit-button" type="button">Sign up/Sign in</button>
        </div>
      </form>
    </div>
    <footer class="footer">
      <div class="container-fluid">
        <nav class="footer-nav">
          <ul class="footer-list">
            <li class="footer-item inline"><a href="http://epa.ms/ENGX">http://epa.ms/ENGX</a></li>
            <li class="footer-item inline"><a href="http://epa.ms/EPMDOJO">http://epa.ms/EPMDOJO</a></li>
            <li class="footer-item inline"><a href="http://epa.ms/ENGXYAMMER">http://epa.ms/ENGXYAMMER</a></li>
          </ul>
        </nav>
      </div>
    </footer>

  </body>
</html>
