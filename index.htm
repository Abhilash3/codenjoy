<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="./files/style.css">

<script type="text/javascript" src="./files/jquery-3.1.0.js"></script>
<script type="text/javascript" src="./files/jquery-ui.js"></script>
<script type="text/javascript">

/*
 * This work by http://www.elated.com is licensed under a Creative Commons Attribution 3.0 Unported License (http://creativecommons.org/licenses/by/3.0/)
 * Saved from url=(0131)http://www.elated.com/res/File/articles/development/javascript/jquery/drag-and-drop-with-jquery-your-essential-guide/card-game.html
 **/
 
$(init);

function init() {

	var size = 7;
	for (var y = 0; y < size; y++) {
		for (var x = 0; x < size; x++) {
			$('<div>' + (y*size + x + 1) + '</div>')
				.data('point', {x : x, y : y})
				.appendTo('#cardSlots');
		}
	}
	
	for (var x = 1; x <= 20; x++) {
		$('<div></div>')
			.data('data', x)
			.appendTo('#cardPile');
	}
	
	$('#cardPile>div').each(function(index, element) {
		index = index + 1;
		$('<div class="ui-draggable type-' + (index % 11) + '">' + index  + '</div>')
			.data('data', x)
			.appendTo(element);		
	});
	
	var park = function(card, slot) {
		var fromSlot = card.data('parkedTo');
		if (!!fromSlot) {
			fromSlot.data('parked', null);
		}
		slot.data('parked', card);
		card.data('parkedTo', slot);
		card.position({of: slot, my: 'left top', at: 'left top'});
	}
	
	var freeSlot = function() {
		var slots = $('#cardPile>div');
		for (var index in slots) {
			var slot = $(slots[index]);
			if (!slot.data('parked')) {
				return slot;
			}
		}
	}
	
	var isOnCardPile = function(slot) {
		return slot.parent().attr('id') == 'cardPile';
	}

	$('#cardPile>div>div').draggable({
		cursor: 'move',
		revert: function (event, ui) {
			// Thanks to http://stackoverflow.com/a/5848800
			// return boolean
			// that evaluate like this:
			// return event !== false ? false : true;
			return !event;
		}
	})
	
	$('#cardPile>div>div').each(function(index, element) {
		var card = $(this);
		var slot = card.parent();
		park(card, slot);
	}).dblclick(function(element) {
		var card = $(this);
		if (isOnCardPile(card.data('parkedTo'))) {
			return;
		} 
		var slot = freeSlot();
		park(card, slot);
	});

    $('#cardSlots>div, #cardPile>div').droppable({
		hoverClass: 'hovered',
		drop: function (event, ui) {
			var slot = $(this);
			if (slot.hasClass('ui-draggable')) {
				slot = slot.data('parkedTo');
			}
			var card = ui.draggable;

			var busy = !!slot.data('parked')
			card.draggable('option', 'revert', busy);
			if (busy) {
				return;
			}
			park(card, slot);
			if (isOnCardPile(slot)) {
				// moved back				
			} else {
				// moved to slot
			}
		}
	});
}


</script>

</head>
<body style="cursor: auto;">

<div id="content">
  <div id="cardPile"></div>  
  <div id="cardSlots"></div>
</div>
</body></html>